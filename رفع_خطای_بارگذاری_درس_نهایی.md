# โ ุฑูุน ุฎุทุง ุจุงุฑฺฏุฐุงุฑ ุฏุฑุณ - ูุณุฎู ููุง

## ูุดฺฉูุงุช ุฑูุน ุดุฏู:

### 1. โ ูุดฺฉู ุนุฏู ุฏุณุชุฑุณ ุจู ุฏุชุงุจุณ

**ูุดฺฉู:**
- ููุช `SUPABASE_KEY` ุชูุธู ูุดุฏู ุจุงุดุฏุ `supabase` ุจุฑุงุจุฑ `None` ุงุณุช
- ุชุงุจุน `get_lesson_data` ููุท `None` ุจุฑูโฺฏุฑุฏุงูุฏ
- ุฏุฑุณโูุง ุจุงุฑฺฏุฐุงุฑ ููโุดููุฏ

**ุฑุงูโุญู:**
- ุงุถุงูู ฺฉุฑุฏู **fallback ุจู local content**
- ุงฺฏุฑ ุฏุชุงุจุณ ุฏุฑ ุฏุณุชุฑุณ ูุจุงุดุฏุ ุงุฒ `lessons_content_new.py` ุงุณุชูุงุฏู ูโฺฉูุฏ
- ููู ุฏุฑุณโูุง ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ ุญุช ุจุฏูู ุฏุชุงุจุณ

**ุชุบุฑุงุช:**
```python
def get_lesson_data(lesson_number: int):
    """Get lesson data from database or fallback to local content"""
    # Try database first
    if supabase:
        try:
            result = supabase.table("lessons").select("*").eq("lesson_number", lesson_number).execute()
            if result.data and len(result.data) > 0:
                logger.info(f"โ Lesson {lesson_number} loaded from database")
                return result.data[0]
        except Exception as e:
            logger.warning(f"โ๏ธ  Error getting lesson {lesson_number} from database: {e}")
            logger.info(f"๐ก Falling back to local lesson content...")
    
    # Fallback to local content
    try:
        lesson_data = get_lesson_by_number(lesson_number)
        if lesson_data:
            logger.info(f"โ Lesson {lesson_number} loaded from local content")
            # Convert local format to database format
            return {
                "id": lesson_number,
                "lesson_number": lesson_number,
                "title": lesson_data.get("title", f"ุฏุฑุณ {lesson_number}"),
                "content": json.dumps(lesson_data.get("content", []), ensure_ascii=False),
                "code_examples": json.dumps(lesson_data.get("code_examples", []), ensure_ascii=False),
                "expected_outputs": json.dumps(lesson_data.get("expected_outputs", []), ensure_ascii=False),
                "is_free": True
            }
    except Exception as e:
        logger.error(f"โ Error getting lesson {lesson_number} from local content: {e}")
    
    return None
```

---

### 2. โ ูุดฺฉู ููู ุจูุฏู ุฏุฑุณโูุง ุจุฏูู ุฏุชุงุจุณ

**ูุดฺฉู:**
- ููุช ุฏุชุงุจุณ ูุณุชุ `check_lesson_exam_passed` ููุดู `False` ุจุฑูโฺฏุฑุฏุงูุฏ
- ููู ุฏุฑุณโูุง ููู ูโุดููุฏ

**ุฑุงูโุญู:**
- ุงฺฏุฑ ุฏุชุงุจุณ ูุณุชุ ุฏุณุชุฑุณ ุจู ููู ุฏุฑุณโูุง ุฑุง ุจุฏู

**ุชุบุฑุงุช:**
```python
def check_lesson_exam_passed(telegram_id: int, lesson_number: int) -> bool:
    """Check if user passed exam for a lesson"""
    # If no database, allow access to all lessons
    if not supabase:
        logger.info(f"โ๏ธ  No database connection - allowing access to lesson {lesson_number}")
        return True
    # ... rest of the function
```

---

### 3. โ ุจูุจูุฏ ูุฏุฑุช JSON Parsing

**ูุดฺฉู:**
- ุงฺฏุฑ `content` ุง `code_examples` ุจู ุตูุฑุช string ูุจุงุดูุฏุ ุฎุทุง ูโุฏูุฏ
- ุงฺฏุฑ JSON ูุนุชุจุฑ ูุจุงุดุฏุ ุฎุทุง ูโุฏูุฏ

**ุฑุงูโุญู:**
- ุจุฑุฑุณ ููุน ุฏุงุฏู ูุจู ุงุฒ parsing
- ูุฏุฑุช ุฎุทุงูุง JSON parsing

**ุชุบุฑุงุช:**
```python
# Parse code examples - handle both string and list formats
code_examples_raw = lesson_data.get("code_examples", "[]")
if isinstance(code_examples_raw, str):
    try:
        code_examples = json.loads(code_examples_raw)
    except json.JSONDecodeError:
        logger.error(f"Error parsing code_examples JSON for lesson {lesson_number}")
        code_examples = []
else:
    code_examples = code_examples_raw if isinstance(code_examples_raw, list) else []
```

---

## ูุชุฌู:

โ **ุจุงุช ุญุงูุง ฺฉุงุฑ ูโฺฉูุฏ ุญุช ุจุฏูู ุฏุชุงุจุณ!**
- ุฏุฑุณโูุง ุงุฒ `lessons_content_new.py` ุจุงุฑฺฏุฐุงุฑ ูโุดููุฏ
- ููู ุฏุฑุณโูุง ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ
- ุฎุทุงูุง JSON parsing ูุฏุฑุช ูโุดููุฏ
- ูุงฺฏโูุง ูุงุถุญโุชุฑ ุจุฑุง ุฏุจุงฺฏ

---

## ุฌุฑุงู ฺฉุงุฑ ุฌุฏุฏ:

1. **ุจุง ุฏุชุงุจุณ:**
   ```
   ฺฉุงุฑุจุฑ โ ุงูุชุฎุงุจ ุฏุฑุณ โ ุจุฑุฑุณ ุฏุชุงุจุณ โ ุจุงุฑฺฏุฐุงุฑ ุงุฒ ุฏุชุงุจุณ โ ุงุฑุณุงู ุฏุฑุณ
   ```

2. **ุจุฏูู ุฏุชุงุจุณ (fallback):**
   ```
   ฺฉุงุฑุจุฑ โ ุงูุชุฎุงุจ ุฏุฑุณ โ ุฏุชุงุจุณ ุฏุฑ ุฏุณุชุฑุณ ูุณุช โ ุจุงุฑฺฏุฐุงุฑ ุงุฒ local content โ ุงุฑุณุงู ุฏุฑุณ
   ```

---

**ููู ูุดฺฉูุงุช ุฑูุน ุดุฏูุฏ! ๐**

